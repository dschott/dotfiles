#!/usr/bin/env sh

! command-exists git && exit


if git-has-changes; then
    echo "local changes found. aborting!"
    exit 1
fi

message="$(git stash list -1 | sed -n 's/^.*:.*:[^ ]* *\(.*\)$/\1/p')"
echo "Committing with message '${message}'"

if [ -z "${message}" ]; then
    echo "stash message is empty. aborting!"
    exit 1
fi

git stash pop --quiet
git add .
git commit -m "${message}"

echo
echo "LOG"
git log --pretty=format:"%s" -4 | sed 's/^/    /'

echo
echo "STASH"
git stash list --pretty=format:"%s" -4 | sed 's/^/    /'
