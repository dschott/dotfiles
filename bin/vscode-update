#!/usr/bin/env sh

[ -z "$(command -v code)" ] && exit

vscode-dump-extensions
vscode-dump-settings
vscode-dump-keybindings

git -C ${DOTPATH} diff --color etc/vscode | cat

if git -C ${DOTPATH} diff --cached --exit-code; then
    echo
    read -p "Commit changes (y/n)? " commit
    echo

    if [ "${commit}" = "y" ]; then
        git -C ${DOTPATH} add etc/vscode
        git -C ${DOTPATH} commit -m "update vscode user settings" -- etc/vscode
        git -C ${DOTPATH} push
    else
        printf "\nNot gonna do shit. Reverting and aborting commit.\n"
        git -C ${DOTPATH} checkout etc/vscode/* 2> /dev/null
        exit 1
    fi
else
    echo "There are other staged changes. Aborting commit."
    exit 1
fi
